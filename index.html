<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hounds and Jackals</title>
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <style>
    /* Global Reset & Basic Styles */
    * {
      margin: 0; padding: 0;
      box-sizing: border-box;
    }
    body {
      background: #fafafa;
      font-family: "Papyrus", cursive, serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
    }
    h1, h2, p {
      text-align: center;
      color: #8b4513;
    }
    /* Layout */
    #gameWrapper {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 20px;
      width: 100%;
      margin: 20px;
    }
    /* Left Panel */
    #leftPanel {
      min-width: 150px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #releaseControls { margin-top: 15px; }
    #releaseControls button {
      margin: 5px; padding: 5px 10px; font-size: 16px;
    }
    #offBoardCounts {
      margin-top: 10px; font-size: 16px;
    }
    #unusedRollBtn {
      display: none;
      margin: 5px;
      padding: 5px 10px;
      font-size: 16px;
      cursor: pointer;
      background: #ffcc00;
      border: none;
      border-radius: 6px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
      color: #333;
      font-family: "Papyrus", cursive, serif;
    }
    /* Right Panel */
    #rightPanel {
      min-width: 200px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #moveHistory {
      font-size: 16px;
      padding: 10px;
      border: 2px solid #8b4513;
      border-radius: 6px;
      background: #fff;
      max-height: 400px;
      overflow-y: auto;
      width: 200px;
      text-align: left;
      user-select: text;
      white-space: pre-wrap;
      word-wrap: break-word;
      cursor: text;
      position: relative;
      z-index: 100;
    }
    #copyHistoryBtn {
      margin-top: 10px;
      padding: 5px 10px;
      font-size: 16px;
      cursor: pointer;
      background: #ffcc00;
      border: none;
      border-radius: 6px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
      color: #333;
      font-family: "Papyrus", cursive, serif;
      z-index: 100;
    }
    /* Center Panel */
    #gameContainer {
      position: relative;
      width: 100%;
      max-width: 900px;
      padding: 20px 20px 80px 20px;
      background: linear-gradient(to bottom, #f5e6ca, #ecd8b5);
      border: 10px double #8b4513;
      border-radius: 6px;
      margin-bottom: 20px;
      overflow: hidden;
    }
    canvas {
      display: block;
      background: radial-gradient(#fef9e7, #e8d6a4);
      margin: auto;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
    }
    /* Overlays */
    .overlayScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.95);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 20px;
      border: 10px double #8b4513;
      border-radius: 6px;
      z-index: 10;
      overflow-y: auto;
    }
    .overlayScreen.active {
      display: flex;
    }
    /* Instructions */
    #instructionsContent {
      font-size: 20px;
      margin: 10px;
    }
    #instructionsNav {
      margin-top: 10px;
    }
    /* Button Styles */
    button {
      font-size: 18px;
      margin: 10px;
      padding: 10px 20px;
      cursor: pointer;
      background: #ffcc00;
      border: none;
      border-radius: 6px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
      color: #333;
      font-family: "Papyrus", cursive, serif;
    }
    /* Dice Display */
    #diceRollDisplay {
      font-size: 24px;
      padding: 10px;
      border: 2px solid #8b4513;
      border-radius: 6px;
      background: #fff;
      margin-bottom: 10px;
    }
    /* Temporary Message Overlay */
    #diceMessageOverlay {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      padding: 10px 20px;
      background: rgba(255,255,255,0.9);
      border: 2px solid #8b4513;
      border-radius: 6px;
      font-family: "Papyrus", cursive, serif;
      font-size: 28px;
      color: #8b4513;
      display: none;
      z-index: 1500;
    }
    /* Logo */
    #logo {
      position: fixed;
      bottom: 10px;
      right: 10px;
      max-width: 100px;
      z-index: 2000;
    }
  </style>
</head>

<body>
  <div class="header-title">
    <h2>Another Product Invented</h2>
    <h1>Hounds and Jackals</h1>
  </div>

  <div id="gameWrapper">
    <!-- Left Panel -->
    <div id="leftPanel">
      <div id="diceRollDisplay">Dice: -</div>
      <button id="rollDiceBtn">Roll Dice</button>
      <button id="unusedRollBtn">Use Unused Roll</button>
      <button id="ignoreUnusedRollBtn" style="display: none;">Ignore Unused Roll</button>
      <input type="number" id="customDiceInput" min="1" max="6" placeholder="Set Dice (1-6)">
      <button id="setCustomDiceBtn">Use Custom Dice</button>
      <div id="releaseControls">
        <button id="releaseHoundBtn">Release Hound</button>
      </div>
      <div id="offBoardCounts">
        <span id="houndsCount">Hounds Off-board: 5</span><br>
        <span id="jackalsCount">Jackals Off-board: 5</span>
      </div>
    </div>

    <!-- Center Panel -->
    <div id="gameContainer">
      <div id="diceMessageOverlay"></div>

      <!-- Menu Screen -->
      <div id="menuScreen" class="overlayScreen active">
        <h1>Hounds and Jackals</h1>
        <button id="newGameBtn">New Game</button>
        <button id="instructionsBtn">Instructions</button>
      </div>

      <!-- Instructions Screen -->
      <div id="instructionsScreen" class="overlayScreen">
        <div id="instructionsContent"></div>
        <div id="instructionsNav">
          <button id="instructionsPrevBtn">Previous</button>
          <button id="instructionsNextBtn">Next</button>
        </div>
      </div>

      <!-- Difficulty Screen -->
      <div id="difficultyScreen" class="overlayScreen">
        <p>Select AI Difficulty:</p>
        <button id="easyBtn">Easy</button>
        <button id="mediumBtn">Medium</button>
        <button id="hardBtn">Hard</button>
      </div>

      <!-- Game Over Screen -->
      <div id="gameOverScreen" class="overlayScreen">
        <h2 id="gameOverText"></h2>
        <button id="gameOverNewGameBtn">New Game</button>
        <p>Press [M] to return to the Main Menu.</p>
      </div>

      <!-- Trays & Canvas -->
      <div id="jackalsTray" style="display: flex; gap: 10px; justify-content: center; margin-bottom: 10px;"></div>
      <canvas id="gameCanvas" width="820" height="320" style="width: 100%; height: auto;"></canvas>
      <div id="houndsTray" style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;"></div>
    </div>

    <!-- Right Panel -->
    <div id="rightPanel">
      <div id="moveHistory" contenteditable="true">Moves:<br></div>
      <button id="copyHistoryBtn">Copy History</button>
    </div>
  </div>

  <!-- Logo -->
  <img id="logo" src="logo.png" alt="Logo">

  <script>
    /**********************************************************
      1) VARIABLE DECLARATIONS & REFERENCES
    **********************************************************/
    let canvas, ctx;
    let menuScreenEl, instructionsScreenEl, difficultyScreenEl, gameOverScreenEl, gameOverTextEl;
    let diceRollDisplayEl, rollDiceBtn, unusedRollBtn, ignoreUnusedRollBtn;
    let moveHistoryDiv, instructionsContentEl, instructionsPrevBtn, instructionsNextBtn;
    let customDiceInput, setCustomDiceBtn, copyHistoryBtn;
    let releaseHoundBtn;
    let houndsCountEl, jackalsCountEl;

    let gameState = "menu"; // "menu", "instructions", "selectDifficulty", "playing", "gameover"
    let currentInstructionsPage = 0;
    let aiDifficulty = "medium";

    // Four possible turn states:
    // "hounds", "hounds_unused", "jackals", "jackals_unused"
    let turnState = "hounds";

    // For dice logic:
    let currentDiceRoll = 0;
    let diceRolled = false;
    let extraTurn = false;
    let unusedRoll = null;
    let unusedRollOwner = null;

    // Board definitions:
    let boardPath = [];
    let boardSquares = {};
    let boardPathHounds = ["E5","E6","E7","E8","E9","D15","D14","D13","D12","D11","D10","D9","D8","D7","D6","D5","D4","D3","D2","D1","C1","C2","C3","C4","C5","C6","C7","C8","C9","C10"];
    let boardPathJackals = ["E5","E4","E3","E2","E1","A15","A14","A13","A12","A11","A10","A9","A8","A7","A6","A5","A4","A3","A2","A1","B1","B2","B3","B4","B5","B6","B7","B8","B9","B10"];
    const SLOT_RADIUS = 7, SLOT_SPACING = 44, START_X = 40, START_Y = 100;

    // Piece images
    let houndsImg = new Image();
    let jackalsImg = new Image();

    // Hounds & Jackals piece positions
    let NUM_PIECES = 5;
    let houndsPieces = [];
    let jackalsPieces = [];
    let moveHistory = [];
    let lastTurnReported = "";

    // 2) On window load, define everything in-scope
    window.addEventListener("load", function() {
      /**********************************************************
        2A) GET HTML ELEMENT REFERENCES
      **********************************************************/
      canvas = document.getElementById("gameCanvas");
      ctx = canvas.getContext("2d");

      menuScreenEl = document.getElementById("menuScreen");
      instructionsScreenEl = document.getElementById("instructionsScreen");
      difficultyScreenEl = document.getElementById("difficultyScreen");
      gameOverScreenEl = document.getElementById("gameOverScreen");
      gameOverTextEl = document.getElementById("gameOverText");

      diceRollDisplayEl = document.getElementById("diceRollDisplay");
      rollDiceBtn = document.getElementById("rollDiceBtn");
      unusedRollBtn = document.getElementById("unusedRollBtn");
      ignoreUnusedRollBtn = document.getElementById("ignoreUnusedRollBtn");

      moveHistoryDiv = document.getElementById("moveHistory");
      instructionsContentEl = document.getElementById("instructionsContent");
      instructionsPrevBtn = document.getElementById("instructionsPrevBtn");
      instructionsNextBtn = document.getElementById("instructionsNextBtn");

      customDiceInput = document.getElementById("customDiceInput");
      setCustomDiceBtn = document.getElementById("setCustomDiceBtn");
      copyHistoryBtn = document.getElementById("copyHistoryBtn");

      releaseHoundBtn = document.getElementById("releaseHoundBtn");
      houndsCountEl = document.getElementById("houndsCount");
      jackalsCountEl = document.getElementById("jackalsCount");

      /**********************************************************
        2B) ATTACH EVENT LISTENERS
      **********************************************************/
      rollDiceBtn.addEventListener("click", humanRollDice);
      setCustomDiceBtn.addEventListener("click", () => {
        if (gameState !== "playing" || turnState !== "hounds" || diceRolled) return;
        const customValue = parseInt(customDiceInput.value);
        if (isNaN(customValue) || customValue < 1 || customValue > 6) {
          showTemporaryMessage("Invalid dice value!");
          return;
        }
        processDiceRoll(customValue);
      });

      ignoreUnusedRollBtn.addEventListener("click", function() {
        unusedRoll = null;
        unusedRollOwner = null;
        updateTurn(); // Switch states as normal if needed
      });

      releaseHoundBtn.addEventListener("click", () => {
        if (turnState !== "hounds") {
          showTemporaryMessage("Not your turn!");
          return;
        }
        if (!diceRolled || currentDiceRoll !== 6) {
          showTemporaryMessage("Must roll a 6 to release!");
          return;
        }
        const index = houndsPieces.findIndex(p => p === -1);
        if (index === -1) {
          showTemporaryMessage("No off-board hounds left!");
          return;
        }
        tryMovePiece(index, "hounds");
      });

      copyHistoryBtn.addEventListener("click", () => {
        const historyText = moveHistoryDiv.innerText;
        navigator.clipboard.writeText(historyText)
          .then(() => { showTemporaryMessage("History copied to clipboard!"); })
          .catch(() => { showTemporaryMessage("Failed to copy history!"); });
      });

      instructionsPrevBtn.onclick = () => {
        currentInstructionsPage--;
        updateInstructions();
      };
      instructionsNextBtn.onclick = () => {
        currentInstructionsPage++;
        updateInstructions();
      };

      // Overlay navigation
      document.getElementById("newGameBtn").onclick = () => showDifficultyScreen();
      document.getElementById("instructionsBtn").onclick = () => showInstructions();
      const gameOverNewGameBtn = document.getElementById("gameOverNewGameBtn");
      if (gameOverNewGameBtn) {
        gameOverNewGameBtn.onclick = () => showDifficultyScreen();
      }

      // AI difficulty
      document.getElementById("easyBtn").onclick = () => setDifficulty("easy");
      document.getElementById("mediumBtn").onclick = () => setDifficulty("medium");
      document.getElementById("hardBtn").onclick = () => setDifficulty("hard");

      // Canvas clicks
      canvas.addEventListener("click", handleBoardClick);

      // Key events
      document.addEventListener("keydown", (e) => {
        const key = e.key.toLowerCase();
        if (gameState === "selectDifficulty") {
          if (key === "e") setDifficulty("easy");
          else if (key === "m") setDifficulty("medium");
          else if (key === "h") setDifficulty("hard");
        } else if (gameState === "playing") {
          if (key === "r" && turnState === "hounds" && !diceRolled) {
            humanRollDice();
          } else if (key === "m") {
            initPieces();
            showMenu();
          }
        } else if (gameState === "instructions" || gameState === "gameover") {
          if (key === "m") {
            initPieces();
            showMenu();
          }
        }
      });

      // Now do board squares initialization
      setupBoardSquares();
      // Load images
      houndsImg.src = "hounds.png";
      jackalsImg.src = "jackals.png";

      // Start the game loop & show menu
      showMenu();
      requestAnimationFrame(mainLoop);
    });

    /**********************************************************
      3) BOARD SQUARES & PATH SETUP
    **********************************************************/
    function setupBoardSquares() {
      // Basic path
      boardPath = [];
      boardSquares = {};
      // We define squares for A1..A15, D1..D15, B1..B10, C1..C10, plus E1..E9
      for (let i = 1; i <= 15; i++) {
        boardSquares["A"+i] = { x: START_X + (i-1)*SLOT_SPACING, y: START_Y };
        boardPath.push("A"+i);
      }
      for (let i = 1; i <= 15; i++) {
        boardSquares["D"+i] = { x: START_X + (i-1)*SLOT_SPACING, y: START_Y + SLOT_SPACING*3.6 };
        boardPath.push("D"+i);
      }
      for (let i = 1; i <= 10; i++) {
        boardSquares["B"+i] = { x: START_X + (i-1)*SLOT_SPACING, y: START_Y + SLOT_SPACING*1.2 };
        boardPath.push("B"+i);
      }
      for (let i = 1; i <= 10; i++) {
        boardSquares["C"+i] = { x: START_X + (i-1)*SLOT_SPACING, y: START_Y + SLOT_SPACING*2.4 };
        boardPath.push("C"+i);
      }
      // Arch "E" squares
      const archCenters = [
        { x: boardSquares["A15"].x + SLOT_SPACING * 0.65, y: boardSquares["A15"].y + SLOT_SPACING * 0.2 },
        { x: boardSquares["A15"].x + SLOT_SPACING * 1.3,  y: boardSquares["A15"].y + SLOT_SPACING * 0.4 },
        { x: boardSquares["A15"].x + SLOT_SPACING * 2.0,  y: boardSquares["A15"].y + SLOT_SPACING * 0.7 },
        { x: boardSquares["A15"].x + SLOT_SPACING * 2.6,  y: boardSquares["A15"].y + SLOT_SPACING * 1.2 },
        { x: boardSquares["A15"].x + SLOT_SPACING * 3.2,  y: boardSquares["A15"].y + SLOT_SPACING * 1.9 },
        { x: boardSquares["A15"].x + SLOT_SPACING * 2.6,  y: boardSquares["A15"].y + SLOT_SPACING * 2.6 },
        { x: boardSquares["A15"].x + SLOT_SPACING * 2.0,  y: boardSquares["A15"].y + SLOT_SPACING * 3.1 },
        { x: boardSquares["A15"].x + SLOT_SPACING * 1.3,  y: boardSquares["A15"].y + SLOT_SPACING * 3.4 },
        { x: (boardSquares["D15"].x + boardSquares["A15"].x + SLOT_SPACING * 1.3) / 2,
          y: (boardSquares["D15"].y + boardSquares["A15"].y + SLOT_SPACING * 3.4) / 2 }
      ];
      for (let i = 0; i < 9; i++) {
        boardSquares["E"+(i+1)] = archCenters[i];
        boardPath.push("E"+(i+1));
      }
    }

    /**********************************************************
      4) MAIN LOOP
    **********************************************************/
    function mainLoop() {
      if (gameState === "playing") {
        redrawPlayScreen();
        // Show the Roll Dice button only if it's the "hounds" turn
        // (since the user is the Hounds).
        rollDiceBtn.style.display = (turnState === "hounds") ? "inline-block" : "none";
        // The "unused roll" buttons are shown/hidden by updateUnusedRollButton().
      }
      requestAnimationFrame(mainLoop);
    }
function handleBoardClick(event) {
  const rect = canvas.getBoundingClientRect();
  const x = event.clientX - rect.left;
  const y = event.clientY - rect.top;
  console.log(`Board clicked at: ${x}, ${y}`);
}

    /**********************************************************
      5) GAME LOGIC, DRAWING, & UI
    **********************************************************/
    function redrawPlayScreen() {
      // Clear & redraw everything
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBoard();
      drawPieces();
      updateDiceRollDisplay();
      updateTrays();
      updateMoveHistoryDisplay();
      updateUnusedRollButton();
    }

    // Hounds & Jackals start
    function initPieces() {
      houndsPieces = Array(NUM_PIECES).fill(-1);
      jackalsPieces = Array(NUM_PIECES).fill(-1);
      moveHistory = [];
      lastTurnReported = "";
      updateTrays();
      updateOffBoardCounts();
    }

    /**********************************************************
      5A) SIMPLE HELPER FUNCTIONS
    **********************************************************/
    function showMenu() {
      hideAllScreens();
      gameState = "menu";
      menuScreenEl.classList.add("active");
    }

    function showInstructions() {
      hideAllScreens();
      gameState = "instructions";
      instructionsScreenEl.classList.add("active");
      updateInstructions();
    }

    function showDifficultyScreen() {
      hideAllScreens();
      gameState = "selectDifficulty";
      difficultyScreenEl.classList.add("active");
    }

    function showGameOver() {
      hideAllScreens();
      gameState = "gameover";
      gameOverScreenEl.classList.add("active");
    }

    function hideAllScreens() {
      menuScreenEl.classList.remove("active");
      instructionsScreenEl.classList.remove("active");
      difficultyScreenEl.classList.remove("active");
      gameOverScreenEl.classList.remove("active");
    }

    function setDifficulty(d) {
      aiDifficulty = d;
      startPlaying();
    }

    function startPlaying() {
      hideAllScreens();
      gameState = "playing";
      initPieces();
      turnState = "hounds"; // user starts
      diceRolled = false;
      currentDiceRoll = 0;
      extraTurn = false;
      unusedRoll = null;
      unusedRollOwner = null;
      addMoveToHistory("Hounds Turn! Roll dice...");
      showTemporaryMessage("Hounds Turn! Roll dice...");
    }

    function updateInstructions() {
      const instructionsPages = [
        "Welcome to Hounds and Jackals! Use dice rolls to move your pieces.",
        "Roll a 6 to bring a piece onto the board. Land on special tiles for bonus moves.",
        "Teleport between linked tiles. Avoid blocking your own path!",
        "Win by getting all your pieces to the end or claiming all special tiles."
      ];
      if (currentInstructionsPage < 0) currentInstructionsPage = 0;
      if (currentInstructionsPage >= instructionsPages.length) currentInstructionsPage = instructionsPages.length - 1;
      instructionsContentEl.textContent = instructionsPages[currentInstructionsPage];
    }

    function showTemporaryMessage(msg) {
      const overlay = document.getElementById("diceMessageOverlay");
      overlay.textContent = msg;
      overlay.style.display = "block";
      setTimeout(() => { overlay.style.display = "none"; }, 2000);
    }

    function addMoveToHistory(txt) {
      if (!txt.includes("Turn! Roll dice...") || lastTurnReported !== turnState) {
        moveHistory.push(txt);
        if (txt.includes("Turn! Roll dice...")) {
          lastTurnReported = turnState;
        }
      }
      updateMoveHistoryDisplay();
    }

    function updateMoveHistoryDisplay() {
      moveHistoryDiv.innerHTML = "Moves:<br>" + moveHistory.join("<br>");
    }

    // ─────────────────────────────────────────────────────────
    // 6) ROLLING & MOVEMENT
    // ─────────────────────────────────────────────────────────
    function humanRollDice() {
      if (gameState !== "playing" || turnState !== "hounds" || diceRolled) {
        return;
      }
      const rollVal = Math.floor(Math.random() * 6) + 1;
      currentDiceRoll = rollVal;
      diceRolled = true;
      addMoveToHistory(`hounds rolled ${rollVal}`);
      showTemporaryMessage(`hounds rolled ${rollVal}`);
    }

    function tryMovePiece(pieceIndex, color) {
      if (gameState !== "playing" || color !== "hounds") {
        showTemporaryMessage("Can't move right now!");
        return;
      }
      if (!diceRolled && turnState !== "hounds_unused") {
        showTemporaryMessage("You must roll dice first!");
        return;
      }
      let rollUsed = (turnState === "hounds_unused") ? unusedRoll : currentDiceRoll;
      if (rollUsed < 1 || rollUsed > 6) {
        showTemporaryMessage("No valid dice roll to use!");
        return;
      }
      let pieces = (color === "hounds") ? houndsPieces : jackalsPieces;
      // Releasing from -1
      if (pieces[pieceIndex] === -1) {
        if (rollUsed === 6 && canLandOn(0, color)) {
          executeMove(pieceIndex, 0, color);
          addMoveToHistory(`${color} placed piece on board with a 6.`);
          diceRolled = false;
          currentDiceRoll = 0;
          if (turnState === "hounds_unused") {
            unusedRoll = null;
            unusedRollOwner = null;
          }
          if (!extraTurn) {
            turnState = "jackals"; 
          } else {
            extraTurn = false;
          }
          updateOffBoardCounts();
        } else {
          showTemporaryMessage("Need a 6 to release from off-board!");
        }
      } else {
        // Normal move
        let opts = getMoveOptions(rollUsed, color);
        let moveOpt = opts.find(o => o.pieceIndex === pieceIndex);
        if (!moveOpt) {
          showTemporaryMessage("Move not valid!");
          return;
        }
        executeMove(pieceIndex, moveOpt.toPos, color);
        addMoveToHistory(`${color} moved piece #${pieceIndex + 1}.`);
        diceRolled = false;
        currentDiceRoll = 0;
        if (turnState === "hounds_unused") {
          unusedRoll = null;
          unusedRollOwner = null;
        }
        if (!extraTurn) {
          turnState = "jackals";
        } else {
          extraTurn = false;
        }
      }
      updateOffBoardCounts();
      updateTurn();
    }

    function executeMove(pieceIndex, toPos, color) {
      let own = (color === "hounds") ? houndsPieces : jackalsPieces;
      let fromPos = own[pieceIndex];
      own[pieceIndex] = toPos;
      // Teleport pairs as needed
      const teleportPairs = {
        "A10": "B5", "B5": "A10",
        "D10": "C5", "C5": "D10",
        "B1":  "B3", "B3":  "B1",
        "C1":  "C3", "C3":  "C1"
      };
      const currentLabel = (color === "hounds")
        ? boardPathHounds[toPos]
        : boardPathJackals[toPos];
      if (teleportPairs[currentLabel]) {
        let targetLabel = teleportPairs[currentLabel];
        let targetIndex = (color === "hounds")
          ? boardPathHounds.indexOf(targetLabel)
          : boardPathJackals.indexOf(targetLabel);
        if (targetIndex !== -1 && canLandOn(targetIndex, color)) {
          own[pieceIndex] = targetIndex;
          showTemporaryMessage(`${color} teleports to ${targetLabel}`);
        }
      }
      // Extra turn if landed on special
      const landedLabel = (color === "hounds") ? boardPathHounds[toPos] : boardPathJackals[toPos];
      if (["A5", "A15", "D5", "D15", "E5"].includes(landedLabel)) {
        extraTurn = true;
      }
      // Check if all pieces are finished
      let finished = own.filter(p => p === 29).length;
      if (finished === NUM_PIECES) {
        showGameOver();
      }
    }

    // ─────────────────────────────────────────────────────────
    // 7) TRAY & OFFBOARD
    // ─────────────────────────────────────────────────────────
    function updateTrays() {
      // For you to populate your trays if desired
    }

    function updateOffBoardCounts() {
      const hCount = houndsPieces.filter(p => p === -1).length;
      const jCount = jackalsPieces.filter(p => p === -1).length;
      houndsCountEl.textContent = `Hounds Off-board: ${hCount}`;
      jackalsCountEl.textContent = `Jackals Off-board: ${jCount}`;
    }
  </script>
</body>
</html>
